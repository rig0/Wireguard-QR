<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireGuard QR Generator</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <img src="/css/wg-qr-2.png" alt="App Icon" class="icon">
        <form id="wireguard-form">
            <h2>Interface</h2>
            <label>PrivateKey</label>
            <input type="text" name="PrivateKey" required>
            
            <label>Address</label>
            <input type="text" name="Address" required>
            
            <label>DNS</label>
            <input type="text" name="DNS" required>
            
            <h2>Peer</h2>
            <label>PublicKey</label>
            <input type="text" name="PublicKey" required>
            
            <label>PreSharedKey</label>
            <input type="text" name="PreSharedKey">
            
            <label>AllowedIPs</label>
            <input type="text" name="AllowedIPs" required>
            
            <label>PersistentKeepAlive</label>
            <input type="text" name="PersistentKeepAlive">
            
            <label>Endpoint</label>
            <input type="text" name="Endpoint" required>
            
            <button type="submit">Create</button>
        </form>
    </div>
    
    <div id="qr-popup" class="popup">
        <div class="popup-content">
            <span id="close-popup">&times;</span>
            <h2>Generated QR Code</h2>
            <img id="qr-code-image" alt="QR Code">
        </div>
    </div>

    <script>
        const form = document.getElementById('wireguard-form');
        const popup = document.getElementById('qr-popup');
        const closePopup = document.getElementById('close-popup');
        const qrCodeImage = document.getElementById('qr-code-image');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            const response = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            if (result.qrCode) {
                qrCodeImage.src = result.qrCode;
                popup.style.display = 'block';
            }
        });

        closePopup.addEventListener('click', () => {
            popup.style.display = 'none';
        });

        window.onclick = (event) => {
            if (event.target === popup) {
                popup.style.display = 'none';
            }
        };
    </script>
</body>
</html>
